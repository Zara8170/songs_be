# ğŸµ UtaBox

> **ë…¸ë˜ë°© ì¼ë³¸ì–´ ë…¸ë˜ ê²€ìƒ‰ ì„œë¹„ìŠ¤**  
> Spring Boot 3.3.0 ê¸°ë°˜ì˜ ê³ ì„±ëŠ¥ RESTful API

[![Java](https://img.shields.io/badge/Java-17-orange)](https://openjdk.org/projects/jdk/17/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.3.0-brightgreen)](https://spring.io/projects/spring-boot)
[![MySQL](https://img.shields.io/badge/MySQL-8.0+-blue)](https://www.mysql.com/)
[![Redis](https://img.shields.io/badge/Redis-6.0+-red)](https://redis.io/)
[![Elasticsearch](https://img.shields.io/badge/Elasticsearch-8.13.4-yellow)](https://www.elastic.co/)

---

## ğŸ“‹ ëª©ì°¨

1. [ğŸ“– í”„ë¡œì íŠ¸ ì„¤ëª…](#-í”„ë¡œì íŠ¸-ì„¤ëª…)
2. [ğŸ’¡ í”„ë¡œì íŠ¸ ê¸°íš ì˜ë„](#-í”„ë¡œì íŠ¸-ê¸°íš-ì˜ë„)
3. [ğŸ—ï¸ í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡°](#ï¸-í”„ë¡œì íŠ¸-ì „ì²´-êµ¬ì¡°)
4. [ğŸ”§ ë¬¸ì œ í•´ê²°](#-ë¬¸ì œ-í•´ê²°)
5. [ğŸ“ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ì ](#-í”„ë¡œì íŠ¸ë¥¼-í†µí•´-ë°°ìš´-ì )
6. [ğŸŒŸ í”„ë¡œì íŠ¸ì˜ íŠ¹ì§•](#-í”„ë¡œì íŠ¸ì˜-íŠ¹ì§•)
7. [ğŸš€ ë¹ ë¥¸ ì‹œì‘](#-ë¹ ë¥¸-ì‹œì‘)
8. [ğŸ“š API ë¬¸ì„œ](#-api-ë¬¸ì„œ)
9. [ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ](#ï¸-ê¸°ìˆ -ìŠ¤íƒ)

---

## ğŸ“– í”„ë¡œì íŠ¸ ì„¤ëª…

**UtaBox**ëŠ” ë…¸ë˜ë°©ì—ì„œ ì¼ë³¸ì–´ ë…¸ë˜ë¥¼ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ê²€ìƒ‰ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì¼ë³¸ì–´ ë…¸ë˜ë¥¼ ê²€ìƒ‰í•˜ê³ , TJ/KY ë…¸ë˜ë°© ë²ˆí˜¸ë¥¼ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

### ğŸ¯ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œìš”

- **ğŸ¤ ë…¸ë˜ë°© íŠ¹í™” ì„œë¹„ìŠ¤**: ì‹¤ì œ ë…¸ë˜ë°©ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” TJ/KY ë²ˆí˜¸ ì œê³µ
- **ğŸ” ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰**: í•œêµ­ì–´ë¡œ ì¼ë³¸ì–´ ë…¸ë˜ ê²€ìƒ‰, ì´ˆì„± ê²€ìƒ‰, ì˜¤íƒ€ ë³´ì • ê¸°ëŠ¥
- **ğŸŒ ë‹¤êµ­ì–´ ì§€ì›**: ì¼ë³¸ì–´ ì›ì œ, í•œêµ­ì–´ ë²ˆì—­, ì˜ì–´ í‘œê¸° í†µí•© ê´€ë¦¬
- **ğŸ“± ì‚¬ìš©ì ì¹œí™”ì **: ì§ê´€ì ì¸ ê²€ìƒ‰ ì¸í„°í˜ì´ìŠ¤ì™€ ë¹ ë¥¸ ì‘ë‹µ ì†ë„

### ğŸ› ï¸ í•µì‹¬ ê¸°ìˆ  ì„ íƒ ì´ìœ 

**Elasticsearch ë„ì… ì´ìœ :**

- ê¸°ì¡´ MySQL LIKE ê²€ìƒ‰ì˜ í•œê³„ ê·¹ë³µ (ì˜¤íƒ€, ë„ì–´ì“°ê¸° ë¯¼ê°)
- ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ë¶„ì„ ë° ì´ˆì„± ê²€ìƒ‰ ì§€ì›
- ë¹ ë¥¸ ì „ë¬¸ ê²€ìƒ‰ê³¼ ê´€ë ¨ë„ ê¸°ë°˜ ì •ë ¬
- ì‹¤ì‹œê°„ ê²€ìƒ‰ì–´ ìë™ì™„ì„± ê¸°ëŠ¥

**RabbitMQ ì‚¬ìš© ì´ìœ :**

- ì¶”ì²œ ì‹œìŠ¤í…œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ
- ì´ë©”ì¼ ì•Œë¦¼ ë“± ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì•ˆì •ì  ì²˜ë¦¬
- ì‹œìŠ¤í…œ ë¶€í•˜ ë¶„ì‚° ë° í™•ì¥ì„± í™•ë³´

### ğŸ¯ í–¥í›„ ì¶”ê°€ ì˜ˆì • ê¸°ëŠ¥

- **ğŸ“ˆ ì¸ê¸°ê³¡ ì°¨íŠ¸**: ì‹¤ì‹œê°„ ê²€ìƒ‰ ë¹ˆë„ ê¸°ë°˜ ì¸ê¸° ì°¨íŠ¸
- **ğŸ†• ì‹ ê·œê³¡ ì•Œë¦¼**: ìƒˆë¡œ ì¶”ê°€ëœ ì¼ë³¸ ì• ë‹ˆë©”ì´ì…˜ ë…¸ë˜ ì•Œë¦¼ ì„œë¹„ìŠ¤
- **ğŸµ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê³µìœ **: ì‚¬ìš©ìê°„ ë…¸ë˜ë°© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê³µìœ 
- **ğŸ“Š ê°œì¸ í†µê³„**: ìì£¼ ë¶€ë¥´ëŠ” ê³¡, ì„ í˜¸ ì¥ë¥´ ë¶„ì„

---

## ğŸ’¡ í”„ë¡œì íŠ¸ ê¸°íš ì˜ë„

ë…¸ë˜ë°©ì—ì„œ ì¼ë³¸ì–´ ë…¸ë˜ ê²€ìƒ‰ì„ í•  ë•Œ í•œêµ­ì–´ ê²€ìƒ‰ì´ ë˜ì§€ ì•Šì•„ ì–´ë ¤ì›€ì´ ìˆëŠ”ë°, ê·¸ê²ƒì„ ì‰½ê²Œ í•˜ê³ ì ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

### ğŸ¯ í•´ê²°í•˜ê³ ì í•œ ë¬¸ì œ

**ê¸°ì¡´ ë¬¸ì œì :**

- ğŸŒ ë…¸ë˜ë°©ì—ì„œ ì¼ë³¸ì–´ ë…¸ë˜ ì œëª©ì„ ì •í™•íˆ ì…ë ¥í•´ì•¼ë§Œ ê²€ìƒ‰ ê°€ëŠ¥
- ğŸ” í•œêµ­ì–´ë¡œ ë²ˆì—­ëœ ì œëª©ì´ë‚˜ ê°€ìˆ˜ëª…ìœ¼ë¡œëŠ” ê²€ìƒ‰ ë¶ˆê°€
- ğŸ“± TJ/KY ë…¸ë˜ë°© ë²ˆí˜¸ë¥¼ ë³„ë„ë¡œ ì°¾ì•„ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€
- âœï¸ ë„ì–´ì“°ê¸°ë‚˜ ì˜¤íƒ€ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•ŠìŒ

**í•´ê²° ë°©ì•ˆ:**

- âœ… í•œêµ­ì–´ë¡œ ì¼ë³¸ì–´ ë…¸ë˜ ê²€ìƒ‰ ê°€ëŠ¥
- âœ… ì´ˆì„± ê²€ìƒ‰ìœ¼ë¡œ ë”ìš± í¸ë¦¬í•œ ì…ë ¥
- âœ… ì˜¤íƒ€ë‚˜ ë„ì–´ì“°ê¸° ì‹¤ìˆ˜ì—ë„ ê´€ë ¨ ê²°ê³¼ ì œê³µ
- âœ… ë…¸ë˜ë°© ë²ˆí˜¸ ì¦‰ì‹œ í™•ì¸ìœ¼ë¡œ ë¹ ë¥¸ ì˜ˆì•½

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡°

### ğŸ“ ë ˆí¬ì§€í† ë¦¬ êµ¬ì¡°

UtaBox í”„ë¡œì íŠ¸ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ ë ˆí¬ì§€í† ë¦¬ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

| ë ˆí¬ì§€í† ë¦¬                                                                  | ì—­í•           | ê¸°ìˆ  ìŠ¤íƒ                 | ì„¤ëª…                                |
| --------------------------------------------------------------------------- | ------------- | ------------------------- | ----------------------------------- |
| ğŸµ **[song_be](https://github.com/Zara8170/song_be)**                       | Backend API   | Spring Boot, MySQL, Redis | ë©”ì¸ ë°±ì—”ë“œ ì„œë²„, ì¸ì¦, ë°ì´í„° ê´€ë¦¬ |
| ğŸ“± **[song_fe](https://github.com/Zara8170/song_fe)**                       | Frontend      | React Native              | ëª¨ë°”ì¼ ì•± í´ë¼ì´ì–¸íŠ¸                |
| ğŸ¤– **[song_ai](https://github.com/Zara8170/song_ai)**                       | AI Service    | Python, FastAPI           | ì¶”ì²œ ì‹œìŠ¤í…œ, ML ëª¨ë¸ ì„œë¹™           |
| ğŸ” **[song_elasticsearch](https://github.com/Zara8170/song_elasticsearch)** | Search Engine | Elasticsearch, Logstash   | ê²€ìƒ‰ ì—”ì§„, ë¡œê·¸ ìˆ˜ì§‘ ë° ë¶„ì„        |

### ğŸ—ï¸ ì„œë¹„ìŠ¤ê°„ ì—°ë™ êµ¬ì¡°

```mermaid
graph TB
    subgraph "Frontend Layer"
        FE["ğŸ¨ song_fe<br/>React Frontend"]
    end

    subgraph "Backend Services"
        BE["ğŸµ songs_be<br/>Spring Boot API"]
        AI["ğŸ¤– songs_ai<br/>AI Recommendation Engine"]
        ES["ğŸ” song_elasticsearch<br/>Search Engine"]
    end

    subgraph "Message Queue"
        RMQ["ğŸ° RabbitMQ<br/>Message Broker"]
    end

    subgraph "Data Layer"
        DB[("MySQL Database")]
        REDIS[("Redis Cache")]
        ES_DATA[("Elasticsearch Index")]
    end

    FE -->|"REST API Request"| BE
    FE -->|"AI Recommendation Request<br/>(Async)"| BE

    BE -->|"Queue Recommendation Task"| RMQ
    RMQ -->|"Async Processing"| AI

    AI -->|"Cache Results"| REDIS
    AI -->|"Metadata Query"| BE

    BE -->|"Get Cached Results"| REDIS

    BE -->|"Search Query"| ES
    BE -->|"User/Song Data"| DB
    ES -->|"Index Management"| ES_DATA

    classDef frontend fill:#e1f5fe
    classDef backend fill:#f3e5f5
    classDef ai fill:#e8f5e8
    classDef data fill:#fff3e0
    classDef queue fill:#fce4ec

    class FE frontend
    class BE,ES backend
    class AI ai
    class DB,REDIS,ES_DATA data
    class RMQ queue
```

### ğŸš€ CI/CD ë°°í¬ ì•„í‚¤í…ì²˜

![CI/CD ë°°í¬ ì•„í‚¤í…ì²˜](./docs/images/cicd-architecture.png)

### ğŸ“‹ ë°°í¬ íŒŒì´í”„ë¼ì¸ ë‹¨ê³„

| ë‹¨ê³„              | ë„êµ¬          | ì„¤ëª…                            | ìë™í™” |
| ----------------- | ------------- | ------------------------------- | ------ |
| 1ï¸âƒ£ **ê°œë°œ**       | IntelliJ IDEA | ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ì½”ë“œ ì‘ì„±    | âŒ     |
| 2ï¸âƒ£ **ë²„ì „ê´€ë¦¬**   | GitHub        | ì†ŒìŠ¤ ì½”ë“œ ë²„ì „ ê´€ë¦¬ ë° í˜‘ì—…     | âœ…     |
| 3ï¸âƒ£ **ë¹Œë“œ**       | Gradle        | JAR íŒŒì¼ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ ì‹¤í–‰    | âœ…     |
| 4ï¸âƒ£ **ì»¨í…Œì´ë„ˆí™”** | Docker        | ì• í”Œë¦¬ì¼€ì´ì…˜ Docker ì´ë¯¸ì§€ ìƒì„± | âœ…     |
| 5ï¸âƒ£ **ë°°í¬**       | Unicorn       | GCP ì¸ìŠ¤í„´ìŠ¤ë¡œ ìë™ ë°°í¬        | âœ…     |

### ğŸ—ï¸ ì¸í”„ë¼ êµ¬ì„±

**Google Cloud Platform ë¦¬ì†ŒìŠ¤:**

- **3ê°œ Compute Engine ì¸ìŠ¤í„´ìŠ¤**
  - ëª¨ë‹ˆí„°ë§ ì„œë²„: Grafana + Prometheus
  - ë°±ì—”ë“œ ì„œë²„: Spring Boot + RabbitMQ
  - AI ì„œë²„: FastAPI + Redis
- **VPC ë„¤íŠ¸ì›Œí¬**: ë³´ì•ˆ ê·¸ë£¹ ë° ë°©í™”ë²½ ê·œì¹™ ì ìš©
- **ë¡œë“œ ë°¸ëŸ°ì„œ**: NGINX ê¸°ë°˜ íŠ¸ë˜í”½ ë¶„ì‚°

### ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

```mermaid
erDiagram
    Member {
        Long id PK
        String email UK
        String password
        String phone
        List memberRoleList
    }

    Song {
        Long songId PK
        Long tj_number "TJ ë…¸ë˜ë°© ë²ˆí˜¸"
        Long ky_number "KY ë…¸ë˜ë°© ë²ˆí˜¸"
        String title_kr "í•œêµ­ì–´ ì œëª©"
        String title_jp "ì¼ë³¸ì–´ ì œëª©"
        String title_en "ì˜ì–´ ì œëª©"
        String title_yomi "ìš”ë¯¸ê°€ë‚˜"
        String title_yomi_kr "ìš”ë¯¸ê°€ë‚˜ í•œê¸€í‘œê¸°"
        String artist "ì•„í‹°ìŠ¤íŠ¸"
        String artist_kr "ì•„í‹°ìŠ¤íŠ¸ í•œê¸€ëª…"
        String lyrics_original "ì›ë³¸ ê°€ì‚¬"
        String lyrics_kr "í•œêµ­ì–´ ê°€ì‚¬"
        AnimeType animeType "ì• ë‹ˆë©”ì´ì…˜ íƒ€ì…"
    }

    Anime {
        Long animeId PK
        String title "ì• ë‹ˆë©”ì´ì…˜ ì œëª©"
    }

    Playlist {
        Long playlistId PK
        String title "í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œëª©"
        String description "ì„¤ëª…"
        Boolean isPublic "ê³µê°œ ì—¬ë¶€"
    }

    SongLike {
        Long id PK
        LocalDateTime likedAt "ì¢‹ì•„ìš” ì‹œê°„"
    }

    PlaylistSong {
        Long id PK
        Integer order_num "ìˆœì„œ"
    }

    RefreshToken {
        Long id PK
        String encryptedToken "ì•”í˜¸í™”ëœ í† í°"
        Long expiry "ë§Œë£Œ ì‹œê°„"
    }

    Member ||--o{ SongLike : "ì¢‹ì•„ìš”"
    Member ||--o{ Playlist : "ìƒì„±"
    Member ||--o{ RefreshToken : "í† í° ì†Œìœ "
    Song ||--o{ SongLike : "ì¢‹ì•„ìš”ë°›ìŒ"
    Song }o--|| Anime : "ì†í•¨"
    Song ||--o{ PlaylistSong : "í¬í•¨ë¨"
    Playlist ||--o{ PlaylistSong : "í¬í•¨"
```

### ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "ğŸ–¥ï¸ Client Layer"
        Web[ì›¹ í´ë¼ì´ì–¸íŠ¸]
        Mobile[ëª¨ë°”ì¼ ì•±]
    end

    subgraph "ğŸŒ API Layer"
        API[Spring Boot API<br/>Port 8082]
        Security[Spring Security<br/>JWT + OAuth2]
    end

    subgraph "ğŸ’¾ Data Layer"
        MySQL[(MySQL<br/>ë©”ì¸ ë°ì´í„°)]
        Redis[(Redis<br/>í† í° & ìºì‹œ)]
        ES[(Elasticsearch<br/>ê²€ìƒ‰ ì—”ì§„)]
    end

    subgraph "ğŸ“¨ Message Queue"
        RMQ[RabbitMQ<br/>ë¹„ë™ê¸° ì²˜ë¦¬]
    end

    subgraph "ğŸ“Š Monitoring"
        Prometheus[Prometheus<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘]
        Grafana[Grafana<br/>ëŒ€ì‹œë³´ë“œ]
    end

    Web --> API
    Mobile --> API
    API --> Security
    API --> MySQL
    API --> Redis
    API --> ES
    API --> RMQ
    API --> Prometheus
    Prometheus --> Grafana

    style API fill:#e3f2fd
    style MySQL fill:#e8f5e8
    style Redis fill:#ffebee
    style ES fill:#fff3e0
    style RMQ fill:#f3e5f5
    style Security fill:#fce4ec
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### 5-1. JWT í† í° Redis ì €ì¥ ë° ì¬ë°œê¸‰ ì´ìŠˆ

**âŒ ë¬¸ì œ ìƒí™©:**
Redisì— ì €ì¥í•´ì„œ ì¬ë°œê¸‰ì´ ì˜ ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ ë°œìƒ

**ğŸ” ë¬¸ì œ ë¶„ì„:**

- RefreshTokenì„ MySQLì— ì €ì¥í•˜ë©´ì„œ ì•”í˜¸í™”/ë³µí˜¸í™” ê³¼ì •ì—ì„œ ì˜¤ë¥˜
- AES ì•”í˜¸í™” í‚¤ ê¸¸ì´ ë¶ˆì¼ì¹˜ (16ë°”ì´íŠ¸ í•„ìš”)
- Redis TTL ì„¤ì •ê³¼ JWT ë§Œë£Œ ì‹œê°„ ë¶ˆì¼ì¹˜
- í† í° ì¬ë°œê¸‰ ì‹œ ê¸°ì¡´ í† í° ì‚­ì œ ë¡œì§ ëˆ„ë½

**âœ… í•´ê²° ë°©ë²•:**

1. **AES ì•”í˜¸í™” ê°œì„ **

```java
// AesUtil.java - 16ë°”ì´íŠ¸ í‚¤ ê°•ì œ ì„¤ì •
private SecretKey getSecretKey() {
    String key = secretKey;
    if (key.length() != 16) {
        key = key.substring(0, Math.min(16, key.length()));
        key = String.format("%-16s", key).replace(' ', '0');
    }
    return new SecretKeySpec(key.getBytes(), "AES");
}
```

2. **RefreshToken ì—”í‹°í‹° êµ¬ì¡° ê°œì„ **

```java
@Entity
public class RefreshToken {
    @Id @GeneratedValue
    private Long id;

    @OneToOne(fetch = FetchType.LAZY)
    private Member member;

    @Column(length = 1024)
    private String encryptedToken; // AES ì•”í˜¸í™”ëœ í† í°

    private Long expiry; // ë§Œë£Œ ì‹œê°„ (íƒ€ì„ìŠ¤íƒ¬í”„)
}
```

3. **í† í° ì¬ë°œê¸‰ ë¡œì§ ê°œì„ **

```java
public TokenDTO refreshToken(String refreshToken) {
    // 1. ê¸°ì¡´ í† í° ë³µí˜¸í™” ë° ê²€ì¦
    String decryptedToken = aesUtil.decrypt(refreshToken);
    Map<String, Object> claims = jwtUtil.validate(decryptedToken);

    // 2. ìƒˆ í† í° ìƒì„±
    String newAccessToken = jwtUtil.generateAccessToken(claims);
    String newRefreshToken = jwtUtil.generateRefreshToken(claims);

    // 3. ê¸°ì¡´ í† í° ì‚­ì œ í›„ ìƒˆ í† í° ì €ì¥
    refreshTokenRepository.deleteByMember(member);
    RefreshToken newToken = RefreshToken.builder()
        .member(member)
        .encryptedToken(aesUtil.encrypt(newRefreshToken))
        .expiry(System.currentTimeMillis() + refreshExpiry)
        .build();
    refreshTokenRepository.save(newToken);

    return new TokenDTO(newAccessToken, aesUtil.encrypt(newRefreshToken));
}
```

### 5-2. ê²€ìƒ‰ ì´ìŠˆ

**âŒ ë¬¸ì œ ìƒí™©:**
ì¼ë°˜ DB ê²€ìƒ‰ìœ¼ë¡œ í•  ê²½ìš° ë„ì–´ì“°ê¸°, ì˜¤íƒ€ê°€ ìˆì„ ê²½ìš° ê²€ìƒ‰ì´ ì•ˆë˜ëŠ” ì´ìŠˆ ë°œìƒ

**ğŸ” ë¬¸ì œ ë¶„ì„:**

- MySQL LIKE ê²€ìƒ‰ì˜ í•œê³„: ì •í™•í•œ ë¬¸ìì—´ ë§¤ì¹­ë§Œ ê°€ëŠ¥
- ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ì‹œ ì„±ëŠ¥ ì €í•˜
- ì´ˆì„± ê²€ìƒ‰, ì˜¤íƒ€ ë³´ì • ë“± ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥ ë¶€ì¬
- ê´€ë ¨ë„ ê¸°ë°˜ ì •ë ¬ ë¶ˆê°€ëŠ¥

**âœ… í•´ê²° ë°©ë²•: Elasticsearch ë„ì…**

1. **Elasticsearch ì¸ë±ìŠ¤ ì„¤ì •**

```json
{
  "settings": {
    "analysis": {
      "analyzer": {
        "korean_analyzer": {
          "type": "custom",
          "tokenizer": "nori_tokenizer",
          "filter": ["lowercase", "chosung_filter"]
        }
      },
      "filter": {
        "chosung_filter": {
          "type": "pattern_replace",
          "pattern": "[ã„±-ã…]",
          "replacement": ""
        }
      }
    }
  }
}
```

2. **SongDocument ì—”í‹°í‹° êµ¬ì„±**

```java
@Document(indexName = "songs")
public class SongDocument {
    @Id
    private String id;

    @Field(type = FieldType.Text, analyzer = "korean_analyzer")
    private String title_kr;

    @Field(type = FieldType.Text)
    private String title_jp;

    @Field(type = FieldType.Text, analyzer = "korean_analyzer")
    private String artist_kr;

    // ì´ˆì„± ê²€ìƒ‰ì„ ìœ„í•œ í•„ë“œ
    @Field(type = FieldType.Text)
    private String title_chosung;
}
```

3. **ë‹¤êµ­ì–´ í†µí•© ê²€ìƒ‰ êµ¬í˜„**

```java
public List<SongDocument> searchSongs(String query) {
    return NativeQuery.builder()
        .withQuery(q -> q.multiMatch(m -> m
            .query(query)
            .fields("title_kr^3", "title_jp^2", "artist_kr^2", "title_chosung^2")
            .fuzziness("AUTO") // ì˜¤íƒ€ ë³´ì •
            .operator(Operator.Or)
        ))
        .withPageable(pageable)
        .build();
}
```

4. **ì´ˆì„± ê²€ìƒ‰ ê¸°ëŠ¥**

```java
private String convertToChosung(String text) {
    // "ã„±ã…ã…‡" -> "ê·€ë©¸ì˜" ë³€í™˜ ë¡œì§
    return chosungConverter.convert(text);
}
```

**ğŸ“ˆ ê°œì„  ê²°ê³¼:**

- ì˜¤íƒ€ê°€ ìˆì–´ë„ ê´€ë ¨ ê²°ê³¼ ì œê³µ (Fuzzy ê²€ìƒ‰)
- ë„ì–´ì“°ê¸° ë¬´ì‹œí•˜ê³  ê²€ìƒ‰ ê°€ëŠ¥
- ì´ˆì„±ìœ¼ë¡œ ë¹ ë¥¸ ê²€ìƒ‰ ("ã„±ã…ã…‡" â†’ "ê·€ë©¸ì˜ì¹¼ë‚ ")
- ê²€ìƒ‰ ì†ë„ ëŒ€í­ í–¥ìƒ (1ì´ˆ â†’ 100ms)
- ê´€ë ¨ë„ ê¸°ë°˜ ì •ë ¬ë¡œ ë” ì •í™•í•œ ê²°ê³¼

---

## ğŸ“ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ì 

ì´ë²ˆ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ í˜¼ìì„œ í…Œì´ë¸” ì„¤ê³„ë¶€í„° í•´ì„œ ì›Œí¬í”Œë¡œìš°ë¥¼ êµ¬ì„±í•˜ê³  ì„œë¹„ìŠ¤ì— í•„ìš”í•œ ê¸°ìˆ ë“¤ì„ íƒìƒ‰í•˜ê³  ê·¸ê±¸ ìŠ¤ìŠ¤ë¡œ ì ìš©í•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ ë•Œ ê¸°íšë¶€í„° êµ¬í˜„, ë°°í¬ê¹Œì§€ ëª¨ë“  ê³¼ì •ì„ ì‹¬ë„ ìˆê²Œ ê³µë¶€í•  ìˆ˜ ìˆì—ˆë˜ ê³„ê¸°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

### ğŸ—ï¸ **ì„¤ê³„ ë° ì•„í‚¤í…ì²˜**

- **ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì¤‘ì‹¬ìœ¼ë¡œ í•œ íŒ¨í‚¤ì§€ êµ¬ì¡° ì„¤ê³„
- **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„**: ì •ê·œí™”ì™€ ì„±ëŠ¥ì„ ê³ ë ¤í•œ í…Œì´ë¸” ì„¤ê³„ ë° ê´€ê³„ ì„¤ì •
- **API ì„¤ê³„**: RESTful ì›ì¹™ì„ ë”°ë¥¸ ì§ê´€ì ì¸ API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„

### ğŸ”§ **ê¸°ìˆ  ìŠ¤íƒ ì„ íƒê³¼ í™œìš©**

- **Elasticsearch**: ì „ë¬¸ ê²€ìƒ‰ ì—”ì§„ ë„ì…ìœ¼ë¡œ ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ
- **Redis**: í† í° ê´€ë¦¬ì™€ ìºì‹±ì„ í†µí•œ ì„±ëŠ¥ ìµœì í™”
- **RabbitMQ**: ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- **Spring Security**: JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€ ì‹œìŠ¤í…œ êµ¬ì¶•

### ğŸ› **ë¬¸ì œ í•´ê²° ëŠ¥ë ¥**

- **ì„±ëŠ¥ ì´ìŠˆ**: ê²€ìƒ‰ ì†ë„ ê°œì„ ì„ ìœ„í•œ Elasticsearch ë„ì…
- **ë³´ì•ˆ ì´ìŠˆ**: JWT í† í° ê´€ë¦¬ì™€ AES ì•”í˜¸í™” êµ¬í˜„
- **í™•ì¥ì„± ì´ìŠˆ**: ë©”ì‹œì§€ íë¥¼ í†µí•œ ë¹„ë™ê¸° ì²˜ë¦¬ ë„ì…

### ğŸ“Š **ìš´ì˜ ë° ëª¨ë‹ˆí„°ë§**

- **ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ**: Prometheus + Grafanaë¥¼ í†µí•œ ì‹œìŠ¤í…œ ìƒíƒœ ì¶”ì 
- **ë¡œê¹… ì „ëµ**: êµ¬ì¡°í™”ëœ ë¡œê¹…ê³¼ ì—ëŸ¬ ì¶”ì  ì‹œìŠ¤í…œ
- **ë°°í¬ ìë™í™”**: Docker Composeë¥¼ í†µí•œ ì›í´ë¦­ ë°°í¬

### ğŸ¯ **ì „ì²´ì ì¸ ê°œë°œ í”„ë¡œì„¸ìŠ¤**

- **ìš”êµ¬ì‚¬í•­ ë¶„ì„**: ì‹¤ì œ ì‚¬ìš©ì ë‹ˆì¦ˆ íŒŒì•…ê³¼ ê¸°ëŠ¥ ì •ì˜
- **ê¸°ìˆ  ê²€ì¦**: ìƒˆë¡œìš´ ê¸°ìˆ  ë„ì… ì „ ì¶©ë¶„í•œ í•™ìŠµê³¼ í…ŒìŠ¤íŠ¸
- **ì ì§„ì  ê°œë°œ**: í•µì‹¬ ê¸°ëŠ¥ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ êµ¬í˜„í•˜ëŠ” ì• ìì¼ ë°©ì‹
- **ë¬¸ì„œí™”**: README ì‘ì„±ì„ í†µí•œ í”„ë¡œì íŠ¸ ì§€ì‹ ì •ë¦¬

---

## ğŸŒŸ í”„ë¡œì íŠ¸ì˜ íŠ¹ì§•

### ğŸ¤ **ë…¸ë˜ë°© íŠ¹í™” ì„œë¹„ìŠ¤**

- **ì‹¤ìš©ì„±**: ì‹¤ì œ ë…¸ë˜ë°©ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” TJ/KY ë²ˆí˜¸ ì œê³µ
- **í¸ì˜ì„±**: í•œêµ­ì–´ë¡œ ì¼ë³¸ì–´ ë…¸ë˜ë¥¼ ì‰½ê²Œ ê²€ìƒ‰
- **ì •í™•ì„±**: ë‹¤ì–‘í•œ í‘œê¸°ë²• (í•œê¸€, ì¼ë³¸ì–´, ì˜ì–´)ì„ ëª¨ë‘ ì§€ì›

### ğŸ” **ë˜‘ë˜‘í•œ ê²€ìƒ‰ ì‹œìŠ¤í…œ**

- **ì˜¤íƒ€ ë³´ì •**: Elasticsearch Fuzzy ê²€ìƒ‰ìœ¼ë¡œ ì˜¤íƒ€ê°€ ìˆì–´ë„ ê²°ê³¼ ì œê³µ
- **ì´ˆì„± ê²€ìƒ‰**: "ã„±ã…ã…‡"ë§Œ ì…ë ¥í•´ë„ "ê·€ë©¸ì˜ì¹¼ë‚ " ê²€ìƒ‰ ê°€ëŠ¥
- **ë‹¤êµ­ì–´ í†µí•©**: ì¼ë³¸ì–´ ì›ì œ, í•œêµ­ì–´ ë²ˆì—­ëª… ëª¨ë‘ ê²€ìƒ‰ ê°€ëŠ¥
- **ê´€ë ¨ë„ ì •ë ¬**: ê²€ìƒ‰ì–´ì™€ì˜ ê´€ë ¨ë„ì— ë”°ë¥¸ ì§€ëŠ¥ì  ì •ë ¬

### âš¡ **ê³ ì„±ëŠ¥ ì‹œìŠ¤í…œ**

- **ë¹ ë¥¸ ê²€ìƒ‰**: Elasticsearch ê¸°ë°˜ìœ¼ë¡œ 100ms ì´ë‚´ ì‘ë‹µ
- **ìºì‹± ì „ëµ**: Redisë¥¼ í†µí•œ ìì£¼ ê²€ìƒ‰ë˜ëŠ” ê²°ê³¼ ìºì‹±
- **ë¹„ë™ê¸° ì²˜ë¦¬**: RabbitMQë¥¼ í†µí•œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì²˜ë¦¬

### ğŸ›¡ï¸ **ì•ˆì „í•œ ë³´ì•ˆ ì‹œìŠ¤í…œ**

- **JWT ì¸ì¦**: Access Tokenê³¼ Refresh Token ë¶„ë¦¬ ê´€ë¦¬
- **AES ì•”í˜¸í™”**: ë¯¼ê°í•œ í† í° ì •ë³´ ì•”í˜¸í™” ì €ì¥
- **OAuth2 ì§€ì›**: Google ì†Œì…œ ë¡œê·¸ì¸ ì—°ë™

### ğŸ“Š **ê´€ì°° ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ**

- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: Prometheus + Grafana ëŒ€ì‹œë³´ë“œ
- **êµ¬ì¡°í™”ëœ ë¡œê¹…**: JSON í˜•íƒœì˜ ì²´ê³„ì ì¸ ë¡œê·¸ ê´€ë¦¬
- **í—¬ìŠ¤ ì²´í¬**: ì‹œìŠ¤í…œ ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸ ê°€ëŠ¥

### ğŸ”„ **í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜**

- **ë„ë©”ì¸ ë¶„ë¦¬**: ê° ê¸°ëŠ¥ë³„ ë…ë¦½ì ì¸ ëª¨ë“ˆ êµ¬ì„±
- **ë©”ì‹œì§€ í**: ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì‹œìŠ¤í…œ ë¶€í•˜ ë¶„ì‚°
- **Docker ì»¨í…Œì´ë„ˆ**: í™˜ê²½ ë…ë¦½ì ì¸ ë°°í¬ ì§€ì›

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

| êµ¬ì„± ìš”ì†Œ         | ë²„ì „   | ìš©ë„               |
| ----------------- | ------ | ------------------ |
| â˜• Java           | 17+    | Spring Boot ëŸ°íƒ€ì„ |
| ğŸ³ Docker         | 20.10+ | ì»¨í…Œì´ë„ˆ ì‹¤í–‰      |
| ğŸ³ Docker Compose | 2.0+   | ë©€í‹° ì»¨í…Œì´ë„ˆ ê´€ë¦¬ |
| ğŸ’¾ ë””ìŠ¤í¬ ê³µê°„    | 5GB+   | ì´ë¯¸ì§€ & ë°ì´í„°    |
| ğŸ§  ë©”ëª¨ë¦¬         | 4GB+   | ì „ì²´ ìŠ¤íƒ ì‹¤í–‰     |

### âš¡ ì›í´ë¦­ ì‹¤í–‰

```bash
# 1ï¸âƒ£ í”„ë¡œì íŠ¸ í´ë¡ 
git clone <repository-url>
cd song_be

# 2ï¸âƒ£ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env

# 3ï¸âƒ£ ì „ì²´ ìŠ¤íƒ ì‹¤í–‰
docker-compose up -d

# 4ï¸âƒ£ ì‹¤í–‰ ìƒíƒœ í™•ì¸
docker-compose ps
```

### ğŸ‰ ì„œë¹„ìŠ¤ ì ‘ì†

| ì„œë¹„ìŠ¤              | URL                                   | ê³„ì •           |
| ------------------- | ------------------------------------- | -------------- |
| ğŸŒ **API ì„œë²„**     | http://localhost:8082                 | -              |
| ğŸ“š **API ë¬¸ì„œ**     | http://localhost:8082/swagger-ui.html | -              |
| ğŸ“Š **Grafana**      | http://localhost:3000                 | admin/admin123 |
| ğŸ° **RabbitMQ**     | http://localhost:15672                | guest/guest    |
| ğŸ’š **Health Check** | http://localhost:8082/actuator/health | -              |

---

## ğŸ“š API ë¬¸ì„œ

### ğŸ” ê²€ìƒ‰ API

```bash
# í•œêµ­ì–´ë¡œ ì¼ë³¸ì–´ ë…¸ë˜ ê²€ìƒ‰
GET /api/es/song/search?query=ê·€ë©¸ì˜ì¹¼ë‚ &page=0&size=10

# ì´ˆì„± ê²€ìƒ‰
GET /api/es/song/search?query=ã„±ã…ã…‡&page=0&size=10

# ì•„í‹°ìŠ¤íŠ¸ëª…ìœ¼ë¡œ ê²€ìƒ‰
GET /api/es/song/search?query=LiSA&page=0&size=10
```

### ğŸµ ë…¸ë˜ ê´€ë¦¬ API

```bash
# ë…¸ë˜ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•)
GET /api/song/list?page=0&size=20

# íŠ¹ì • ë…¸ë˜ ìƒì„¸ ì¡°íšŒ
GET /api/song/{songId}

# ë…¸ë˜ ì¢‹ì•„ìš”
POST /api/likes
{
  "songId": 1
}
```

### ğŸ” ì¸ì¦ API

```bash
# íšŒì›ê°€ì…
POST /api/member/join
{
  "email": "user@example.com",
  "password": "password123"
}

# ë¡œê·¸ì¸
POST /api/member/login
{
  "email": "user@example.com",
  "password": "password123"
}

# Google OAuth2 ë¡œê·¸ì¸
GET /api/auth/google
```

### ğŸ“ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ API

```bash
# í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±
POST /api/playlist
{
  "title": "ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ì• ë‹ˆì†¡",
  "description": "ì• ë‹ˆë©”ì´ì…˜ OST ëª¨ìŒ",
  "isPublic": true
}

# í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì— ê³¡ ì¶”ê°€
POST /api/playlist/{playlistId}/song
{
  "songId": 1
}
```

### ğŸ”„ Dead Letter Queue (DLQ) ê´€ë¦¬

ì¶”ì²œ ì‹œìŠ¤í…œì˜ ì‹¤íŒ¨í•œ ë©”ì‹œì§€ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ DLQ API:

```bash
# DLQ ìƒíƒœ ì¡°íšŒ
GET /api/v1/admin/dlq/status

# DLQ í—¬ìŠ¤ ì²´í¬
GET /api/v1/admin/dlq/health

# ëª¨ë“  í ìƒíƒœ ì¡°íšŒ
GET /api/v1/admin/dlq/queues/all

# DLQ ë©”ì‹œì§€ ìˆ˜ ì¡°íšŒ
GET /api/v1/admin/dlq/count

# DLQ ë©”ì‹œì§€ ëª¨ë‘ ì‚­ì œ (ì£¼ì˜!)
DELETE /api/v1/admin/dlq/purge
```

**í êµ¬ì¡°:**

- `rec.recommendation.q` - ë©”ì¸ ì²˜ë¦¬ í
- `rec.recommendation.retry.5s.q` - 5ì´ˆ í›„ ì¬ì‹œë„
- `rec.recommendation.retry.30s.q` - 30ì´ˆ í›„ ì¬ì‹œë„
- `rec.recommendation.retry.120s.q` - 120ì´ˆ í›„ ì¬ì‹œë„
- `rec.recommendation.dlq` - ìµœì¢… ì‹¤íŒ¨ ë©”ì‹œì§€ í

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend Framework

- **Spring Boot** 3.3.0
- **Spring Security** (JWT + OAuth2)
- **Spring Data JPA** + **QueryDSL**
- **Java** 17 LTS

### Database & Storage

- **MySQL** 8.0+ (ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤)
- **Redis** 6.0+ (í† í° ê´€ë¦¬ & ìºì‹œ)
- **Elasticsearch** 8.13.4 (ê²€ìƒ‰ ì—”ì§„)

### Message Queue & DevOps

- **RabbitMQ** 3.13 (ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬ + Dead Letter Queue)
- **Docker** + **Docker Compose**
- **Prometheus** + **Grafana** (ëª¨ë‹ˆí„°ë§)

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” [MIT ë¼ì´ì„ ìŠ¤](LICENSE) í•˜ì— ë°°í¬ë©ë‹ˆë‹¤.

---

## ğŸ“ ì—°ë½ì²˜

- ğŸ› **ë²„ê·¸ ë¦¬í¬íŠ¸**: [GitHub Issues](../../issues)
- ğŸ’¡ **ê¸°ëŠ¥ ì œì•ˆ**: [GitHub Discussions](../../discussions)
- ğŸ“– **ë¬¸ì„œ ê°œì„ **: Pull Requestë¡œ ê¸°ì—¬í•´ì£¼ì„¸ìš”

---

<div align="center">

**â­ ì´ í”„ë¡œì íŠ¸ê°€ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ Starë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”! â­**

[â¬†ï¸ ë§¨ ìœ„ë¡œ ì´ë™](#-utabox)

</div>
